<%# Preferences Form Partial %>
<%# Form component for creating or updating user travel preferences %>
<%# Usage: render 'profiles/preferences_form', user_preferences: @user_preferences %>

<% user_preferences ||= nil %>

<div class="space-y-6">
  <h2 class="block antialiased font-sans text-2xl font-semibold leading-snug text-blue-gray-900">
    Travel Preferences
  </h2>
  
  <p class="block antialiased font-sans text-sm font-normal leading-normal text-blue-gray-700">
    Set your travel preferences to help us generate personalized trip plans. All fields are optional and can be updated at any time.
  </p>
  
  <%# Ensure form always has a model object (required for form_with) %>
  <%# Always use persisted record if it exists, so form helpers can read values %>
  <% form_model = user_preferences.present? ? user_preferences : UserPreference.new %>
  
  <%= form_with model: form_model, url: preferences_path, method: :put, html: { class: 'space-y-6', data: { turbo: true, turbo_cache: false } } do |form| %>
    <%# Budget Field %>
    <%= render 'shared/form_field', 
        form: form, 
        field_name: :budget, 
        field_type: 'select', 
        select_options: budget_options,
        prompt: 'Select your budget preference...',
        required: false %>
    
    <%# Accommodation Field %>
    <%= render 'shared/form_field', 
        form: form, 
        field_name: :accommodation, 
        field_type: 'select', 
        select_options: accommodation_options,
        prompt: 'Select your accommodation preference...',
        required: false %>
    
    <%# Activities Field Group (custom checkbox component) %>
    <%= render 'profiles/activities_field_group', 
        form: form, 
        activities: user_preferences&.activities, 
        errors: user_preferences&.errors&.[](:activities) || [] %>
    
    <%# Eating Habits Field %>
    <%= render 'shared/form_field', 
        form: form, 
        field_name: :eating_habits, 
        field_type: 'select', 
        select_options: eating_habits_options,
        prompt: 'Select your eating habits preference...',
        required: false %>
    
    <%# Form Actions %>
    <%= render 'shared/form_actions', 
        submit_text: 'Save Preferences', 
        cancel_path: root_path, 
        cancel_text: 'Cancel' %>
  <% end %>
</div>

