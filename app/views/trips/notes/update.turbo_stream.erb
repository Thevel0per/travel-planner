<%# Turbo Stream for note update %>
<%# Updates the specific note item in the list based on success or validation errors %>

<% if @note.errors.empty? %>
  <%# Reload the note to get updated timestamps %>
  <% @note.reload %>
  
  <%# Replace the entire note item to avoid nesting %>
  <%= turbo_stream.replace "note_#{@note.id}" do %>
    <%= render 'trips/note_item', note: @note %>
  <% end %>
  
  <%# Update toast container to show flash message %>
  <%= turbo_stream.update "toast-container" do %>
    <%= render 'shared/toast_container' %>
  <% end %>
<% else %>
  <%# Re-render the note item with validation errors %>
  <%# Note: Since notes are displayed as read-only items, we'll update the entire notes list %>
  <%# to show any error state. In a real implementation, you might want inline editing %>
  <% @trip.reload %>
  <%= turbo_stream.update "notes_list" do %>
    <%= render 'trips/notes_list', notes: @trip.notes.order(created_at: :desc) %>
  <% end %>
  
  <%# Show error message in toast %>
  <%= turbo_stream.update "toast-container" do %>
    <%= render 'shared/toast_container' %>
  <% end %>
<% end %>

